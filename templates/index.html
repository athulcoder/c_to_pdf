<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>C File to PDF Converter</title>
	<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

	<style>
		:root {
			--bg: #232323;
			--fg: #d4d4d4;
			--accent: #448eef;
			--terminal-bg: #000000;
			--terminal-text: #42f557;
			--terminal-error-text: #c7163c;
		}

		body {
			font-family: "Courier New", monospace;
			background: var(--bg);
			color: var(--fg);
			padding: 16px;
			margin: 0;
		}

		h2 {
			color: var(--accent);
			text-align: center;
			font-family: sans-serif;
		}

		.terminal {
			background: var(--terminal-bg);
			color: var(--terminal-text);
			padding: 15px;
			height: 300px;
			margin: auto;
			white-space: pre-wrap;
			overflow-y: auto;
			border-radius: 6px;
			font-size: 14px;
			line-height: 1.4;
			margin-top: 10px;
			position: relative;
			scrollbar-width: 0;
			-ms-overflow-style: none;

		}

		.terminal::-webkit-scrollbar {
			display: none;
		}

		input[type="file"],
		.form-grid input {
			width: 300px;
			padding: 8px;
			margin-top: 5px;
			border: 1px solid #555;
			border-radius: 6px;
			background: #2c2c2c;
			color: #fff;
		}

		input[type="file"]::file-selector-button {
			margin-right: 10px;
			padding: 8px 16px;
			background: var(--accent);
			border: none;
			border-radius: 6px;
			font-weight: bold;
			color: #000;
			cursor: pointer;
		}

		.form-grid input:focus {
			outline: 1px solid var(--accent);
		}

		label {
			margin-top: 10px;
			display: block;
		}

		button {
			margin-top: 10px;
			padding: 8px 16px;
			background: var(--accent);
			border: none;
			border-radius: 6px;
			font-weight: bold;
			color: #000;
			cursor: pointer;
		}

		button i {
			margin-right: 5px;
		}

		button:hover {
			opacity: 0.9;
		}

		.form-grid {
			display: flex;
			flex-direction: column;
			gap: 10px;
			margin-top: 15px;
		}

		#generateBtn {
			display: none;
		}

		.theme-toggle {
			position: absolute;
			right: 20px;
			top: 20px;
			font-size: 20px;
			background: transparent;
			border: none;
			color: var(--accent);
		}

		footer {
			text-align: center;
			font-size: 14px;
			margin-top: 30px;
			padding: 10px;
			border-top: 1px solid #444;
			color: #888;
		}

		footer a {
			color: #aca105;
			text-decoration: none;
			font-family: sans-serif;
		}

		.terminal-input {
			margin-top: 10px;
			padding:8px;
			border: none;
			width: calc(100% - 16px);
			margin:auto;
			margin-top:10px;
			background: #111;
			color: var(--terminal-text);
			font-family: "Courier New", monospace;
			font-size: 14px;
			border-radius: 6px;
		}

		.terminal-input:focus{
          border:none;
			 outline:none;
		}

		@media (max-width: 600px) {
			.terminal {
				height: 250px;
			}

			h2 {
				font-size: 15px;
			}

			input[type="file"],
			.form-grid input {
				width: 100%;
				margin-right: 3px;
				box-sizing: border-box;
			}

			.container {
				flex-direction: column;
				width: 100%;
			}

			.right {
				padding: 0;
			}
		}


		.container {
			display: flex;

		}

		.right {
			flex-grow: 1;
			padding: 1rem;
		}

		.left {
			flex-shrink: 0;
		}

		#runBtn {
			background-color: #36e34b;
			display:none;
		}

		#generateBtn {
			background-color: salmon;
		}

		.title{
		  margin-bottom: 5rem;
		}
	</style>

</head>

<body>
	<h2 class="title">C File to PDF Converter</h2>


	<main class="container">

		<section class="left">
			<form id="uploadForm">
				<input type="file" name="cfile" required />
			</form>

			<div class="form-grid">
				<div>
					<label for="name">Experiment Name *</label>
					<input type="text" id="expname" placeholder="Experiment Name" required />
				</div>
				<div>
					<label for="name">Student Name *</label>
					<input type="text" id="name" placeholder="Student Name" required />
				</div>
				<div>
					<label for="rollno">Roll No *</label>
					<input type="text" id="rollno" placeholder="Roll No" required />
				</div>
				<div>
					<label for="date">Date *</label>
					<input type="date" id="date" required />
				</div>
			</div>

			<button type="submit" onclick="uploadCode()"><i class="fas fa-upload"></i> Upload</button>
			<button onclick="runCode()" id="runBtn"><i class="fas fa-play"></i> Run</button>
			<button id="generateBtn" onclick="generatePDF()">
				<i class="fas fa-file-pdf"></i> Generate PDF
			</button>
		</section>

		<section class="right">


			<div class="terminal" id="terminal"></div>
			<input type="text" id="terminalInput" class="terminal-input" placeholder="Type here..." />
		</section>
	</main>

	<footer>
		Built by
		<a href="https://github.com/athulcoder" target="_blank">athulcoder</a>
	</footer>

	<script>
		const socket = io();
		let sessionId = null;



		const terminal = document.getElementById("terminal");
		const generateBtn = document.getElementById("generateBtn")
		const TerminalInput = document.getElementById("terminalInput");
		const themeIcon = document.getElementById("theme-icon");

		document
			.getElementById("uploadForm")
			.addEventListener("submit", async function (e) {
				e.preventDefault();
				const formData = new FormData(this);

				const res = await fetch("/upload", {
					method: "POST",
					body: formData,
				});

				const data = await res.json();
			  
		  document.getElementById("runBtn").style.display="block"
				if (data.success) {
					sessionId = data.session;
					terminal.textContent = "";
					terminal.style.color = "var(--terminal-text)"
					appendToTerminal("Compiled successfully. Press â–¶ Run.\n");
				} else {
					terminal.style.color = "var(--terminal-error-text)"
					terminal.textContent = data.output || "Compilation failed.";
				}
			});

		function uploadCode() {
			document.getElementById("uploadForm").requestSubmit();
		}

		function runCode() {

			terminal.style.color = "var(--terminal-text)"
			if (!sessionId) {
				alert("Please upload and compile a file first.");
				return;
			}

			socket.emit("start_execution", {session: sessionId});
			generateBtn.style.display = "inline-block";
			terminal.textContent = ""
			terminalInput.focus();
		}

		function appendToTerminal(text) {
			terminal.textContent += text;
			terminal.scrollTop = terminal.scrollHeight;
		}

		terminalInput.addEventListener("keydown", function (e) {
			if (!sessionId) return;

			if (e.key === "Enter") {
				const value = terminalInput.value;
				socket.emit("send_input", {
					session: sessionId,
					input: value + "\n",
				});
				terminalInput.value = "";
				e.preventDefault();
			}
		});

		function generatePDF() {
			const name = document.getElementById("name").value.trim();
			const expname = document.getElementById("expname").value.trim();
			const rollno = document.getElementById("rollno").value.trim();
			const date = document.getElementById("date").value;
			const output = document.getElementById("terminal").innerText;

			if (!name || !expname || !rollno || !date) {
				alert("All fields are required before generating PDF.");
				return;
			}

			socket.emit("generate_pdf", {
				session: sessionId,

				name,
				expname,
				rollno,
				date,
				output,
			});
		}

		socket.on("terminal_output", function (data) {
			appendToTerminal(data);
		});

		socket.on("pdf_generated", (data) => {
			if (data.success) {
				window.open(data.pdf_url, "_blank");
			} else {
				alert("Failed to generate PDF: " + data.error);
			}
		});

		function toggleTheme() {
			document.body.classList.toggle("light");
			themeIcon.classList.toggle("fa-moon");
			themeIcon.classList.toggle("fa-sun");
		}
	</script>
</body>

</html>
